{% extends 'base.html' %}
{% block content %}

<!-- inicio modal -->
{%  include 'includes/modalTipoDato.html' %}
{%  include 'includes/modalValRef.html' %} 
{%  include 'includes/modalCopy.html' %} <!-- Copia del modal base de ValRef-->
{%  include 'includes/grupoCopy.html' %} <!-- Copia del grupo de parametros completo -->

<!-- FIN MODAL -->


<div class="row">
    <div class="col-md-10 col-md-offset-1">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">{{ title }}</h3>
            </div>
            <div class="panel-body">

                <!-- <form class="form-horizontal" method="POST" action="">{% csrf_token %} -->
                <div class="form-horizontal">
                    <div class="form-group">
			    		<label class="control-label col-sm-2" for="descripcion">Descripcion:</label>
			    		<div class="col-sm-4">
			    			<input type="text" class="form-control" id="descripcion" name="descripcion" value="{{ instance.descripcion }}">
			    		</div>
			    		<label class="control-label col-sm-2" for="tecnica">Tecnica:</label>
			    		<div class="col-sm-4">
			    			<input type="text" class="form-control" id="tecnica" name="tecnica" value="{{ instance.tecnica }}">
			    		</div>
				    </div>

                	<div class="form-group">
			    		<label class="control-label col-sm-2" for="muestra">Muestra:</label>
			    		<div class="col-sm-4">
			    			<select class="form-control" name="muestra" id="muestra"></select>
			    		</div>
                	
                		<label class="control-label col-sm-2" for="tercerizacion">Tercerizacion:</label>
						<div class="col-sm-4">
							<div class="checkbox form-check disabled">
								<label class="form-check-label" for="tercerizacion">
    								<input type="checkbox" class="form-check-input" id="tercerizacion" name="tercerizacion" value="{{ instance.tercerizacion }}" > 
								</label>
							</div>
						</div>
                	</div>
            	
<!-- DIV PARAMETROS -->
					<div id="block-parametros">
						<div class="panel panel-default">
							<div class="panel-heading">
								<label class="control-label col-sm-3" for="grupo">Grupo de Parametros</label>

								<input type="text" class="form-control" id="grupo" name="grupo" value="{{ instance.grupo }}">
							</div>
							
							<div class="panel-body"  style="overflow-x:scroll">
								<table class="table table-striped table-hover table-condensed table-responsive" align="center" id="tabla">
									<thead class="thead-default">
										<tr>
											<th class="col-sm-5"><label for="descripcion">Descripcion</label></th>
											<th class="col-sm-3"><label for="tipo_de_dato">Tipo de Dato <a href="#" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-question-sign"></span></a></label></th>
											<th class="col-sm-1"><label>Valor Pred./Ref.</label></th>
											<th class="col-sm-2"><label for="unidadmedida">Unidad de Medida</label></th>
											<th class="col-sm-1"><button id="agregar_parametros"  class="btn btn-default btn-sm">Agregar<br>Parametro <span class="glyphicon glyphicon-plus"></button></th>		
										</tr>
									</thead>
									<tbody>		
										<tr id="hidden-row" style="display: none">
											<td><input type="text" class="form-control" id="descripcion" name="descripcion" value="{{ instance.descripcion }}"></td>
											<td>
												<select id="select" class="selectpicker tipoDatoSelect">
													<option value="I">Número Entero</option>
													<option value="F">Número con decimales</option>
													<option value="B">Positivo/Negativo</option>
													<option value="S">Texto</option>
												</select>
											</td>
											<td><a id="botonIngresarValorRef" class="btn btn-default ModalPara" data-toggle="modal" data-target="#ModalValorRef" class="btn btn-default">Ingresar</a></td>
											<td><input type="text" class="form-control" id="unidadmedida0" name="unidadmedida" value="{{ instance.unidadmedida }}"></td>
											<td><div class="btn btn-danger">Eliminar</div></td>
										</tr>
										<tr>
											<td><input type="text" class="form-control" id="descripcion" name="descripcion" value="{{ instance.descripcion }}"></td>
											<td>
												<select id="select" class="selectpicker tipoDatoSelect">
													<option value="I">Número Entero</option>
													<option value="F">Número con decimales</option>
													<option value="B">Positivo/Negativo</option>
													<option value="S">Texto</option>
												</select>
											</td>
											<td><a id="botonIngresarValorRef" class="btn btn-default ModalPara" data-toggle="modal" data-target="#ModalValorRef0" class="btn btn-default">Ingresar</a><!-- <p style="display:none" id="pBtnIVR">Deshabilitado para ese tipo de dato</p> --></td>
											<td><input type="text" class="form-control" id="unidadmedida1" name="unidadmedida" value="{{ instance.unidadmedida }}"></td>
											<td><div class="btn btn-danger">Eliminar</div></td>
										</tr>
									</tbody>
								</table>
							</div> <!-- fin div panel-body -->
						</div> <!-- fin div panel -->
					</div><!-- fin block-parametros -->
					
						
					<div class="form-group">
			    		<div class="col-sm-12" align="right">
							<button id="addBlockParametros" class="btn btn-default btn-sm">Agregar Grupo de Parametros <span class="glyphicon glyphicon-plus"></button>
						</div>
					</div>

	                <div class="form-group">
				    	<label class="control-label col-sm-3" for="piepagina">Texto para incluir en pie de pagina:</label>
			    		<div class="col-sm-9">
					    	<textarea row="3" class="form-control" id="piepagina" name="piepagina" value="{{ instance.piepagina }}"> </textarea>
			    		</div>
				    </div>
	            
					<div class="form-group">
						<label class="control-label col-sm-2" for="activo">Estado:</label>
						<div class="col-sm-10">
							<div class="checkbox form-check disabled">
								<label class="form-check-label" for="activo">
									<input type="checkbox" class="form-check-input" id="activo" name="activo" value="{{ instance.activo }}" checked disabled> Activo
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
			    		<div class="col-sm-offset-2 col-sm-10" align="right">
							<button type="submit" class="btn btn-success">Enviar</button>
						</div>
					</div>
				<!-- </form> -->
				</div>
    		</div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script type="text/javascript">
$(document).ready(function(){
	
	var num = 0;

	$("body").on('click', "#agregar_parametros", function(){
		var newRow = $('#hidden-row').clone()
						.removeAttr('id')
						.removeAttr('style')
						.show();
		// Clona, remueve id (para evitar duplicados) y stylem y muestra.
        
        num = num+1; // incremento del numero final de los datos del id y data-target

        var modId = "ModalValorRef" + num; // Nuevo Id del Modal
        var modData = "#ModalValorRef" + num; // Nuevo Data-Target value del row recien creado

		$('.modalBase').clone().attr('id', modId).removeClass('modalBase').appendTo( $('#block-parametros').parent()); 
		// Crea el modal para el row recien creado.		
        
        newRow.find("#botonIngresarValorRef").attr('data-target', modData);
    	// Reemplaza la el id que se usa para llamar al model 
    	$(this).parent().parent().parent().parent().append(newRow);
    	// posiciona el row en el grupo de parametros en el que fue pedido.

   
    return false;
	});
	
	$("#block-parametros").on('click', ".ModalPara", function(){
		var posRow = $(this).parent().parent(); // Posiciona la linea entera para usarla.
		var modModel = posRow.find("#descripcion").val(); // busca el valor de descripcion-
		var paraModel = posRow.find("#botonIngresarValorRef").attr('data-target'); // busca el id del modal
		
		$(paraModel).find('#parametro').attr('value', modModel); // remplaza parametros con el valor de descripcion-
	});

	$("#block-parametros").on('click', ".btn-danger", function(){
		var delPos = $(this).parent().parent(); // La linea a eliminar
		var delModel = delPos.find("#botonIngresarValorRef").attr('data-target'); // busca el id del modal
		
		$(delModel).remove(); // Delete Modal
		delPos.remove();
		//$(this).parent().parent().remove(); 
		// Elimina el model y la linea.

	});

	$("body").on('click', ".btn-eliminar-vr", function(){
		$(this).parent().parent().remove(); // Delete Row de valores referencia	
	});


    $("#addBlockParametros").click(function(){
        
        var newTable = $('#grupoParametros').clone()
                        .removeAttr('id')
                        .removeAttr('style')
                        .show()
                        .appendTo('#block-parametros')
        // copia y pega el bloque.

        return false;
    });
	
    $("body").on('click', "#addParametroVr", function(){
		
		var newRow = $('#hidden-row-vr').clone()
						.removeAttr('id')
						.removeAttr('style')
						.show();

		$(this).parent().parent().parent().parent().find('tbody').append(newRow);
		//genera la nueva linea para los valores por referencia.
	});
	
    var selectmuestra = "{{instance.muestra.id}}"
        $.ajax({
            url:"/j_muestra/",
            type:"GET",
            dataType: "json",
            success: function(muestra){
                $.each(muestra,function(index, obj) 
                {   
                    if(obj.id == selectmuestra)
                    {
                    $('#muestra').append('<option selected value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                    else{
                    $('#muestra').append('<option value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                });
            }
        }); // finaliza el select 
    
// OCULTAR LA OPCION DE SELECCIONAR EL VALOR DE REFERENCIA SI ES UN BOOLEAN:
	/*$('.tipoDatoSelect').click(function(){
		var selectedValue = $('.tipoDatoSelect').find(":selected").text();
		if (selectedValue == "Positivo/Negativo") {
			console.log("ingresa al if")
			$('#botonIngresarValorRef').hide()
			$('#pBtnIVR').show()
		} else {
			console.log("ingresa al else")
			$('#botonIngresarValorRef').show()
			$('#pBtnIVR').hide()
		}
	}); */


    $.ajax({
    	url: "/j_especie/",
    	type: "GET",
    	dataType: "json",
    	success: function(especie){
    		$.each(especie, function(index, obj){
    			$('.especieSel').append('<option value=' + obj.id + '>' + obj.descripcion + '</option>');
    		});
    	}
    }); // select de especie 
});  


</script> 

{% endblock %}