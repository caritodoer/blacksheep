{% extends 'base.html' %}
{% block content %}

{% include 'includes/individuoCopy.html' %}

<div class="row">
	<div class="col-md-10 col-md-offset-1">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">{{ title }}</h3>
			</div>
			<!-- <form class="form-horizontal" method="POST" action="">{% csrf_token %} -->
			<div class="form-horizontal">
				<div class="panel-body">

<!-- inicio panel individuo -->
					<div id="block-individuo">
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="panel-title">
									<ol><li>° Individuo</li></ol>
								</div>
								
							</div>
							<div class="panel-body">

								<!-- <div class="row"> -->
								<div class="form-group">
									<div class="divalidacion">	
										<label class="control-label col-sm-2" for="identificacion">Identificación:</label>
					                    <div class="col-sm-4">
					                        <input type="text" class="form-control" id="identificacion" onkeyup="validacion('identificacion');" name="identificacion" value="{{ instance.identificacion }}">
					                        <small>N° de Caravana / DNI del Dueño + Nombre del Animal</small>
					                    </div>
					                </div>
									<div class="divalidacion">
										<label class="control-label col-sm-1" for="raza">Raza:</label>
							    		<div class="col-sm-2">
							    			<select class="form-control razaSel" name="raza" onchange="validacion('raza');"></select>
							    		</div>
							    	</div>	
							    		<button class="btn btn-default" type="button" data-toggle="collapse" data-target="#collapse0" aria-expanded="false" aria-controls="collapse0">Más Opciones  <span class="glyphicon glyphicon-chevron-down"></span></button>
								</div>
								<!-- </div> -->

								<!-- Panel colapsado de "mas opciones" -->
								<div class="collapse" id="collapse0">
				  					<div class="well">
										<div class="form-group">
											<label class="control-label col-sm-2" for="nombre">Nombre:</label>
						                    <div class="col-sm-4">
						                        <input type="text" class="form-control" id="nombre" name="nombre" value="{{ instance.nombre }}">
						                    </div>
						                    
						                    <label class="control-label col-sm-2" for="Edad">Edad:</label>
						                    <div class="col-sm-4">
						                        <input type="number" class="form-control" id="edad" name="edad" value="{{ instance.edad }}">
						                    </div>
										</div>

										<div class="form-group">
											<label class="control-label col-sm-2" for="libreta">Libreta Sanitaria:</label>
						                    <div class="col-sm-4">
						                        <input type="text" class="form-control" id="libreta" name="libreta" value="{{ instance.libreta }}">
						                    </div>

											<label class="control-label col-sm-2" for="categoriae">Categoría de Especie:</label>
								    		<div class="col-sm-4">
								    			<select class="form-control categoriaeSel" name="categoriae"></select>
								    		</div>
										</div>
										
										<div class="form-group">
											<label class="control-label col-sm-2" for="sexo">Sexo:</label>
											<div class="col-sm-4">
												<label class="checkbox-inline">
													<input type="checkbox" value="">M
												</label>
												<label class="checkbox-inline">
													<input type="checkbox" value="">H
												</label>
												<label class="checkbox-inline">
													<input type="checkbox" value="">NS/NC
												</label> 
											</div>
										</div>
				  					</div>	<!-- fin well -->
				  				</div>	<!-- fin collapsado -->

							</div> <!-- fin panel body -->
							
							<div class="panel-footer">
								<div id="rmvBlockIndiv" align="right">
									<div  class="btn btn-sm" >
										Eliminar Individuo <span class="glyphicon glyphicon-remove"></span>
									</div>
								</div> 
							</div>
						</div> 	<!-- fin panel individuo -->
					</div>	
<!-- fin div block-individuo -->

					<div class="form-group">
			    		<div class="col-sm-offset-2 col-sm-10" align="right">
		          			<button id="addBlockIndividuo"  class="btn btn-default btn-sm">Agregar Individuo  <span class="glyphicon glyphicon-plus"></span></button>
						</div>
					</div>
				
				</div>	<!-- fin panel body -->

				<div class="panel-footer">
					<div class="row">
						<div class="col-sm-12" align="right">
							<!-- <a href="../../home_user" > -->
							<button type="button" class="btn btn-default" id="btnvalidar">Continuar</button>
							</a>
						</div>
					</div>
				</div> <!--fin panel footer-->
			</div>
			<!-- </form> -->
		</div>
	</div>
</div>


{% endblock %}

{% block javascript %} 
<script type="text/javascript">
$(document).ready(function() {

	$("#addBlockIndividuo").click(function(){
		var newTable = $('#panelIndividuo').clone()
			.removeAttr('id')
			.removeAttr('style')
			.show()
			.appendTo('#block-individuo')
		return false;
	});

    var selectraza = "{{instance.raza.id}}"
        $.ajax({
            url:"/j_raza/",
            type:"GET",
            dataType: "json",
            success: function(raza){
            	$('#raza').append('<option selected value=""></option>');
                $.each(raza,function(index, obj) 
                {   
                    if(obj.id == selectraza)
                    {
                    $('.razaSel').append('<option selected value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                    else{
                    $('.razaSel').append('<option value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                });
            }
        }); // fin selectraza

    var selectcategoriae = "{{instance.categoriae.id}}"
        $.ajax({
            url:"/j_categoriae/",
            type:"GET",
            dataType: "json",
            success: function(categoriae){
                $.each(categoriae,function(index, obj) 
                {   
                    if(obj.id == selectcategoriae)
                    {
                    $('.categoriaeSel').append('<option selected value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                    else{
                    $('.categoriaeSel').append('<option value=' + obj.id + '>' + obj.descripcion + '</option>');
                    }
                });
            }
        }); // finaliza el select

	$("body").on('click', "#rmvBlockIndiv", function(){
		$(this).parent().parent().remove();
	});
	
	/*validacion*/
	$("span.help-block").hide();


}); //ready 

	/*validacion*/
	function verificar(){
		var v1=0,v2=0;

		v1=validacion('identificacion');
		v2=validacion('raza');
		console.log(v1,v2);
		if(v1 == true && v2 == true){
			return true;
		}
		else{
			return false;
		}
	}//verificar

	$("#btnvalidar").click(function(){
		if(verificar() == true){
			$("#formvalidar").submit();
			$(location).attr('href',"../../home_user");
		}
	});// boton validar

	//funcion retorna array de consulta bd 
	function getconbd(url, method)
	{
	    return JSON.parse($.ajax({
	        type: method,
	        url: url,
	        dataType: 'json',
	        async:false,
	        success: function(data)
	        {
	            return data;
	        }
	    }).responseText);
	}//consulta bd

	function validacion(campo){
		if(campo==='identificacion'){
	        inputtext = document.getElementById(campo).value;
	        console.log(inputtext);
	        if(inputtext == null || inputtext.length == 0 || /^\s+$/.test(inputtext)){
	            $('#icon'+campo).remove();
	            $('#'+campo).parent().parent().attr("class","has-error has-feedback");
	            $('#'+campo).parent().children("span").text("Debe ingresar una "+campo+"").show();
	            $('#'+campo).parent().append("<span id='icon"+campo+"' class='glyphicon glyphicon-remove form-control-feedback'></span>");
	            return false;
	        }
	        else{
	            $("#icon"+campo).remove();
	            $('#'+campo).parent().parent().attr("class","has-success has-feedback");
	            $('#'+campo).parent().children("span").text("").hide();
	            $('#'+campo).parent().append("<span id='icon"+campo+"' class='glyphicon glyphicon-ok form-control-feedback'></span>");
	            return true;                
	        }
	    }//identificacion
		
		if(campo==='raza'){
			indice = document.getElementById(campo).selectedIndex;
			console.log(indice);
			if(indice == null || indice == 0){
				$('#raza').parent().parent().attr("class","form-group has-error");
				return false;
			}
			else{
				$('#raza').parent().parent().attr("class","form-group has-success");
				return true;
			}
		}//especie			
	}//validacion


</script>
{% endblock %}